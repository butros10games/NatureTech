{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="{% static 'css/boer-admin/orders/admin_orders.css' %}" />
  </head>
  <body>
    <table id="booking-table">
      <thead>
        <tr>
          <th data-sort="order_number" data-order="asc">Order Nummer</th>
          <th data-sort="firstname" data-order="asc">Naam</th>
          <th data-sort="start_date" data-order="asc">CheckIn datum</th>
          <th data-sort="end_date" data-order="asc">CheckOut datum</th>
          <th data-sort="age_below" data-order="asc">Kinderen</th>
          <th data-sort="age_above" data-order="asc">Volwasssenen</th>
          <th data-sort="pdf" data-order="asc">PDF</th>
          <th data-sort="checked_in" data-order="asc">Ingecheckt</th>
          <th data-sort="paid" data-order="asc">Betaald</th>
          <th data-sort="phone_number" data-order="asc">Telefoon nummer</th>
          <th data-sort="email" data-order="asc">Email</th>
        </tr>
      </thead>
      <tbody id="table_content">
        {% for booking in page_obj %}
          <tr>
            <td>{{ booking.order_number }}</td>
            <td>{{ booking.customer.user.first_name }} {{ booking.customer.user.last_name }}</td>
            <td>{{ booking.start_date }}</td>
            <td>{{ booking.end_date }}</td>
            <td>{{ booking.age_below }}</td>
            <td>{{ booking.age_above }}</td>
            <td>{{ booking.pdf }}</td>
            <td>{{ booking.checked_in }}</td>
            <td>{{ booking.paid }}</td>
            <td>{{ booking.customer.phone_number }}</td>
            <td>{{ booking.customer.user.email }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">
      <span class="step-links"><a id="prev" pageNumber="0" class="ajax-link">Vorige</a></span>

      <span class="current">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}.</span>

      <span class="step-links"><a id="next" pageNumber="0" class="ajax-link">Volgende</a></span>
    </div>
  </body>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Load the initial data and show the first page
      request_data(1)
    
      // Add click events to the table headers for sorting
      const tableHeaders = document.querySelectorAll('#booking-table th[data-sort]')
      tableHeaders.forEach((header) => {
        header.addEventListener('click', function () {
          console.log('Header clicked') 
    
          const currentSortOrder = header.getAttribute('data-order')
          const newSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc'
          const sortBy = header.getAttribute('data-sort')

		  console.log('Sort By:', sortBy);  // Debugging log
    
          // Set the new sort order
          header.setAttribute('data-order', newSortOrder)
    
          // Get the current page number
          const pageNumber = parseInt(prevButton.getAttribute('pageNumber'))
    
          // Request data with sorting parameters
          sort_data(sortBy, newSortOrder, pageNumber)
        })
      })
    
      const prevButton = document.getElementById('prev')
      const nextButton = document.getElementById('next')
      const tableContent = document.getElementById('table_content')
    
      // Add click event to the prev button
      prevButton.addEventListener('click', function () {
        console.log('clicked')
    
        // Get the page number
        let pageNumber = parseInt(this.getAttribute('pageNumber'))
    
        // If the page number is 0, then we are on the first page
        if (pageNumber === 0) {
          // Disable the prev button
          this.classList.add('disabled')
        } else {
          // Enable the next button
          nextButton.classList.remove('disabled')
    
          // Get the previous page number
          let prevPageNumber = pageNumber - 1
    
          // Set the page number
          this.setAttribute('pageNumber', prevPageNumber)
          nextButton.setAttribute('pageNumber', prevPageNumber)
    
          request_data(prevPageNumber)
        }
      })
    
      // Add click event to the next button
      nextButton.addEventListener('click', function () {
        console.log('clicked')
    
        // Get the page number
        let pageNumber = parseInt(this.getAttribute('pageNumber'))
    
        // Enable the next button
        nextButton.classList.remove('disabled')
    
        // Get the next page number
        let nextPageNumber = pageNumber + 1
    
        // Set the page number
        this.setAttribute('pageNumber', nextPageNumber)
        prevButton.setAttribute('pageNumber', nextPageNumber)
    
        request_data(nextPageNumber)
      })
    
      function request_data(pageNumber) {
        // Get the URL
        let url = window.location.href
    
        const data = {
          csrfmiddlewaretoken: '{{ csrf_token }}',
          page: pageNumber
        }
		console.log(data);
    
        $.ajax({
          type: 'POST',
          url: url,
          data: data,
          success: function (data) {
    
            // Fill the table
            fill_table(data)
          },
          error: function (data) {
            console.log(data)
          }
        })
      }
	  function sort_data(sortBy, sortOrder) {
        let url = window.location.href
    
        const data = {
          csrfmiddlewaretoken: '{{ csrf_token }}',
          sort_by: sortBy,
          order: sortOrder,
		  
        }
		console.log(data);
    
        $.ajax({
          type: 'POST',
          url: url,
          data: data,
          success: function (data) {
			console.log(data);
            // Fill the table with sorted data
            fill_table(data)
          },
          error: function (data) {
            console.log(data)
          }
        })
      }
    
      function fill_table(datas) {
        // Clear the table
        tableContent.innerHTML = ''
    
        // Loop through the data
        for (let i = 0; i < datas.length; i++) {
          field = datas[i]
          // Create a new row
          let row = document.createElement('tr')
    
          // Create the columns
          let orderNumber = document.createElement('td')
          let name = document.createElement('td')
          let checkInDate = document.createElement('td')
          let checkOutDate = document.createElement('td')
          let children = document.createElement('td')
          let adults = document.createElement('td')
          let pdf = document.createElement('td')
          let checkedIn = document.createElement('td')
          let paid = document.createElement('td')
          let phoneNumber = document.createElement('td')
          let email = document.createElement('td')
    
          // Set the text of the columns
          orderNumber.innerText = field.order_number
          name.innerText = field.firstname + ' ' + field.lastname
          checkInDate.innerText = field.start_date
          checkOutDate.innerText = field.end_date
          children.innerText = field.age_below
          adults.innerText = field.age_above
          pdf.innerText = field.pdf
          checkedIn.innerText = field.checked_in
          paid.innerText = field.paid
          phoneNumber.innerText = field.phone_number
          email.innerText = field.email
    
          // Append the columns to the row
          row.appendChild(orderNumber)
          row.appendChild(name)
          row.appendChild(checkInDate)
          row.appendChild(checkOutDate)
          row.appendChild(children)
          row.appendChild(adults)
          row.appendChild(pdf)
          row.appendChild(checkedIn)
          row.appendChild(paid)
          row.appendChild(phoneNumber)
          row.appendChild(email)
    
          // Append the row to the table
          tableContent.appendChild(row)
        }
      }
    
    })
  </script>
</html>
